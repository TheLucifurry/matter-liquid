!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("matter-js")):"function"==typeof define&&define.amd?define(["matter-js"],n):"object"==typeof exports?exports.MatterLiquid=n(require("matter-js")):t.MatterLiquid=n(t.Matter)}(self,(function(t){return(()=>{"use strict";var n={912:(t,n,e)=>{e.r(n);const r=JSON.parse('{"u2":"matter-liquid","i8":"0.0.1"}');var o=e(538),i=e.n(o);const c=0,u=1,s=2,a=3,f=1,l=2;function p(t,n,[e,r,o,i]){return t>e&&t<o&&n>r&&n<i}function d(t,n,e){const r=e-n;return n+((t-n)%r+r)%r}function h(t,n){return t>n?t:n}function m(t,n,e){return t<n?n:t>e?e:t}function y(t){return Math.hypot(t[0],t[1])}function g(t){const n=Math.hypot(t[0],t[1]);return 0!==n?[t[0]/n,t[1]/n]:[0,0]}function v(t,n){return[t[0]*n,t[1]*n]}function x(t,n){return[t[0]/n,t[1]/n]}function b(t,n){return[n[0]+t[0],n[1]+t[1]]}function M(t,n){return[n[0]-t[0],n[1]-t[1]]}function w(t,n){return[t[0]-n[0],t[1]-n[1]]}function j(t,n){let e=-1;const{length:r}=t;for(;++e<r;)n(t[e],e)}function q(t,n,e,r){j(e,((t,e)=>{null===t||n&&!p(t[c],t[u],n)||r(t,e)}))}function O(t,n,e){j(n,(n=>e(t[n],n)))}function P(t,n){return t.sh.getNearItems(n[c],n[u],t.p)}function S(t,n,e){!function(t,n,e){j(n,(n=>e(t[n],n)))}(t.p,P(t,n),e)}function R(t,n){for(const[e,r]of Object.entries(t))n(e,r)}function C(t,n,e){return i().Vertices.contains(t.vertices,{x:n,y:e})}function E(t,n=0){return[t.min.x-n,t.min.y-n,t.max.x+n,t.max.y+n]}function L(t,n,e,r){const o=(n[0]-t[0])*(r[1]-e[1])-(r[0]-e[0])*(n[1]-t[1]);if(0===o)return!1;const i=((r[1]-e[1])*(r[0]-t[0])+(e[0]-r[0])*(r[1]-t[1]))/o,c=((t[1]-n[1])*(r[0]-t[0])+(n[0]-t[0])*(r[1]-t[1]))/o;return i>0&&i<1&&c<1}function B(t,n){return M([t[c],t[u]],[n[c],n[u]])}function I(t,n){t[c]+=n[0],t[u]+=n[1]}function T(t,n){t[c]+=n*t[s],t[u]+=n*t[a]}function A(t,n){const[e,r]=function(t,n){const e=Math.hypot(t[0],t[1]);return v(x(t,e||1),m(e,-n,n))}([t[s],t[a]],n);t[s]=e,t[a]=r}function G(t,n,e){S(t,n,(r=>{const o=B(n,r),i=g(o),c=y(x(o,t.h));if(c<1){const t=(d=n,M([(h=r)[s],h[a]],[d[s],d[a]])),o=y((p=t,[(l=i)[0]*p[0],l[1]*p[1]]));if(o>0){const t=x(v(i,e*(1-c)*(.01*o+.01*o**2)),2);f=t,(u=n)[s]-=f[0],u[a]-=f[1],function(t,n){t[s]+=n[0],t[a]+=n[1]}(r,t)}}var u,f,l,p,d,h}))}function $(t,n,e){O(t.p,n,((n,r)=>{S(t,n,((o,i)=>{if(y(x(B(n,o),t.h))<1){const c=y(B(n,o));let u=10-c;const s=function(t,n){return`${t}.${n}`}(r,i),a=.1*u;c>10+a?u+=.03*e*(c-10-a):c<10-a&&(u-=.03*e*(10-a-c)),void 0===t.s[s]&&(t.s[s]=u)}}))})),R(t.s,((n,e)=>{Math.abs(e)>t.h&&(t.s[n]=void 0)})),R(t.s,((n,r)=>{const[o,i]=function(t){const[n,e]=t.split(".");return[+n,+e]}(n),s=t.p[o],a=t.p[i],f=B(s,a),l=g(f),p=y(f),d=r,h=x(v(l,e**2*.001*(1-d/t.h)*(d-p)),2);var m,b;b=h,(m=s)[c]-=b[0],m[u]-=b[1],I(a,h)}))}function _(t,n,e){const r=[t.position.x,t.position.y];if(t.circleRadius){return b(r,v(g(M(r,e)),t.circleRadius))}var o,i;const c=function(t,n,e){const r=t.vertices;for(let t=0;t<r.length;t++){const o=r[t],i=r[t!==r.length-1?t+1:0],c=[o.x,o.y],u=[i.x,i.y];if(L(c,u,n,e))return[c,u]}return null}(t,(o=n,(i=e)[0]!==o[0]||i[1]!==o[1]?e:r),n),u=function(t,n){const e=g(M([t[0],t[1]],[n[0],n[1]]));return[e[1],-e[0]]}(c[0],c[1]);return function(t,n,e,r){const o=(t[0]-n[0])*(e[1]-r[1])-(t[1]-n[1])*(e[0]-r[0]);if(0===o)return null;const i=t[0]*n[1]-t[1]*n[0],c=e[0]*r[1]-e[1]*r[0];return[(i*(e[0]-r[0])-(t[0]-n[0])*c)/o,(i*(e[1]-r[1])-(t[1]-n[1])*c)/o]}(c[0],c[1],n,b(n,u))}function F(t,n,e,r){const{p:o}=t;(n?function(t,n){return i().Query.region(t,{min:{x:n[0],y:n[1]},max:{x:n[2],y:n[3]}})}(t.w.bodies,n):t.w.bodies).forEach((n=>{const r=function(t,n,e,r){const o=[],i=e.getItemsByBounds(n.bounds);for(let e=0;e<i.length;e++){const r=i[e],s=t[r];C(n,s[c],s[u])&&o.push(r)}return o}(o,n,t.sh);O(o,r,(t=>{if(!p(t[c],t[u],e))return;const r=function(t,n){const e=[n.velocity.x,n.velocity.y],r=w([t[s],t[a]],e),o=g(r),i=w(r,o);return w(o,v(i,1))}(t,n),o=[t[c],t[u]];if(function(t,n){t[s]-=n[0],t[a]-=n[1]}(t,r),C(n,t[c],t[u])){const e=_(n,o,[t[c],t[u]]);t[c]=e[0],t[u]=e[1]}}))}))}function N(t,n,e,r){O(t.p,n,((n,o)=>{!function(t,n,e){t[s]=(t[c]-e[0])/n,t[a]=(t[u]-e[1])/n}(n,e,r[o]);const i=t.bb,f=t.w.bounds;if(t.iwx)n[c]=d(n[c],f.min.x,f.max.x);else{const t=n[c];n[c]=m(t,f.min.x,f.max.x),t!==n[c]&&(n[s]*=-i,n[a]*=i)}if(t.iwy)n[u]=d(n[u],f.min.y,f.max.y);else{const t=n[u];n[u]=m(t,f.min.y,f.max.y),t!==n[u]&&(n[s]*=i,n[a]*=-i)}t.sh.update(o,n[c],n[u])}))}function U(t,n){const e=[],r=Matter.Liquid.getGravity(t),o={},i=t.irc?E(t.r.bounds,t.abp):null,f=E(t.w.bounds);q(0,i,t.p,((i,f)=>{e.push(f),function(t,n,e,r){t[s]+=n*r*e[0],t[a]+=n*r*e[1]}(i,n,r,t.lpl[f][l]),o[f]=[i[c],i[u]],A(i,.6*t.h),T(i,n)})),O(t.p,e,((e,r)=>{!function(t,n,e,r){const o=t.lpl[e][l],i=.2*t.h,c=.3*t.h;let u=0,s=0;const a=P(t,n),f=[];for(let e=0;e<a.length;e++){const r=t.p[a[e]],o=B(n,r),i=y(x(o,t.h));if(i<1){const t=h(1-i,.5);u+=t**2,s+=t**3,f.push([t,o,r])}}const p=.3*(u-i)*o,d=c*s,m=[0,0];for(let t=0;t<f.length;t++){const[n,e,o]=f[t],i=x(v(g(e),r**2*(p*n+d*n**2)),2);m[0]-=i[0],m[1]-=i[1],I(o,i)}I(n,m)}(t,e,r,n)})),F(t,i,f),N(t,e,n,o)}function V(t,n){const e=E(t.r.bounds,t.abp),r=[],o=(Matter.Liquid.getGravity(t),{});q(0,e,t.p,((t,n)=>{r.push(n)})),O(t.p,r,(e=>{G(t,e,n)})),O(t.p,r,((t,e)=>{o[e]=[t[c],t[u]],T(t,n)})),$(t,r,n),O(t.p,r,(t=>{})),N(t,r,n,o)}function J(t,n){if(OffscreenCanvas)return new OffscreenCanvas(t,n);const e=document.createElement("canvas");return e.height=n,e.width=t,e}function Q(t,n){const e=J(6*n,6*n),r=e.getContext("2d");return r.shadowColor=t,r.shadowBlur=2*n,r.fillStyle=t,r.beginPath(),r.arc(3*n,3*n,n,0,2*Math.PI),r.fill(),e}function W(t){const n=t.r.context,e=E(t.r.bounds,t.rbp);j(t.p,((r,o)=>{if(null===r||!p(r[c],r[u],e))return;const i=Math.floor(r[c]),s=Math.floor(r[u]),a=t.lpl[o][f],l=a.height/2;n.drawImage(a,i-l,s-l)}))}function k(t){Matter.Render.startViewTransform(t.r),W(t)}function z(t){function n(t,n){return`${t}.${n}`}function e(t,n){const e=t.indexOf(n);return-1!==e&&t.splice(e,1),t}function r(t,n,e){const r=t.h[e];void 0===r?(t.h[e]=[n],t.p[n]=e):r.includes(n)||(r.push(n),t.p[n]=e)}function o(t,e,r){return t.h[n(e,r)]||[]}function i(t,n,r){const o=t.h[r];e(o,n),delete t.p[n],0===o.length&&delete t.h[r]}const c={h:{},p:{},cs:t,update:(t,e,o)=>{const u=Math.trunc(e/c.cs),s=Math.trunc(o/c.cs),a=c.p[t],f=n(u,s);a!==f&&(void 0!==a&&i(c,t,a),r(c,t,f))},insert:(t,e,o)=>{const i=n(Math.trunc(e/c.cs),Math.trunc(o/c.cs));r(c,t,i)},remove:t=>{const n=c.p[t];i(c,t,n)},getNearItems:(t,r,i)=>{const u=Math.trunc(t/c.cs),s=Math.trunc(r/c.cs),a=n(u,s);return[...o(c,u-1,s-1),...o(c,u,s-1),...o(c,u+1,s-1),...o(c,u-1,s),...e(c.h[a]||[],a),...o(c,u+1,s),...o(c,u-1,s+1),...o(c,u,s+1),...o(c,u+1,s+1)]},getItemsByBounds:t=>{const e=Math.trunc(t.min.x/c.cs),r=Math.trunc(t.min.y/c.cs),o=Math.trunc(t.max.x/c.cs),i=Math.trunc(t.max.y/c.cs),u=[];for(let t=r;t<=i;t++)for(let r=e;r<=o;r++){const e=n(r,t);u.push(...c.h[e]||[])}return u}};return Object.seal(c)}const D=["pauseChange","particleRemove"];function H(){const t={};return D.forEach((n=>t[n]=()=>0)),t}const K={drip(t,n,e,r){const o=0===t.fpids.length?t.p.length:t.fpids.pop(),i=new Float32Array([e,r,0,0]);t.lpl[o]=t.l[n],t.p[o]=i,t.sh.insert(o,e,r)},rect(t,n,e,r,o,i,c=t.h){const u=Matter.Liquid.getLiquidId(t,n),s=c/2,a=h(Math.trunc(o/c),1),f=h(Math.trunc(i/c),1);for(let n=0;n<a;n++)for(let o=0;o<f;o++){const i=e+s+n*c,l=r+s+o*c;K.drip(t,u,i,l),n!==a-1&&o!==f-1&&K.drip(t,u,i+s,l+s)}}},X={dry(t,n){const e=t.p[n];t.p[n]=null,t.sh.remove(n),t.ev.particleRemove(e,n,t.lpl[n]),-1===t.fpids.indexOf(n)&&t.fpids.unshift(n)},rect(t,n,e,r,o){t.p.forEach(((i,s)=>{null!==i&&p(i[c],i[u],[n,e,n+r,e+o])&&X.dry(t,s)}))}},Y={utils:{VirtualCanvas:J},create:function(t){const n=i().Liquid,e=t.radius||32,r=e*(t.particleTextureScale||.3);let o=[false,false];const c=t.worldWrapping;null!=c&&(o="boolean"==typeof c?[c,c]:c);const u={},s=t.liquids.map(((t,n)=>(t.name&&(u[t.name]=n),function(t,n){const e=t.color||"#fff";return[e,t.texture||Q(e,n),t.mass||1]}(t,r)))),a={h:e,iwx:o[0],iwy:o[1],e:t.engine,r:t.render,w:t.engine.world,irc:t.isRegionalComputing||false,l:s,lnlid:u,bb:t.bordersBounce||.8,ip:!1,g:t.gravityRatio||.2,sh:z(e),rbp:0,abp:0,p:[],s:{},fpids:[],lpl:{},t:0,ef:t.updateEveryFrame||2,dt:t.timeScale||1,ev:H(),u:null},f=k,l=t.isAdvancedAlgorithm?V:U;return a.u=()=>{a.t++%a.ef==0&&l(a,a.e.timing.timeScale*a.dt)},i().Events.on(t.render,"afterRender",(()=>f(a))),n.setPause(a,!!t.isPaused),Object.seal(a)},drip:K,dry:X,setPause(t,n=!0){n?i().Events.off(t.e,"afterUpdate",t.u):i().Events.on(t.e,"afterUpdate",t.u),t.ip=n,t.ev.pauseChange(n)},setRenderBoundsPadding(t,n){t.rbp=n},setActiveBoundsPadding(t,n){t.abp=n},setGravityRatio(t,n=t.g){t.g=n},setUpdateEveryFrame(t,n=t.ef){t.ef=n},setTimeScale(t,n=t.dt){t.dt=n},getGravity:t=>[t.w.gravity.x*t.g,t.w.gravity.y*t.g],getParticlesCount:t=>t.p.length-t.fpids.length,getLiquidId:(t,n)=>"number"==typeof n?n:t.lnlid[n]},Z={name:r.u2,version:r.i8,for:"matter-js@0.16.1",install(t){t.Liquid=Y}};Matter.Plugin.register(Z)},538:n=>{n.exports=t}},e={};function r(t){var o=e[t];if(void 0!==o)return o.exports;var i=e[t]={exports:{}};return n[t](i,i.exports,r),i.exports}return r.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return r.d(n,{a:n}),n},r.d=(t,n)=>{for(var e in n)r.o(n,e)&&!r.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},r.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r(912)})()}));