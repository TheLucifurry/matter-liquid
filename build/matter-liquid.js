!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("matter-js")):"function"==typeof define&&define.amd?define(["matter-js"],n):"object"==typeof exports?exports.MatterLiquid=n(require("matter-js")):t.MatterLiquid=n(t.Matter)}(self,(function(t){return(()=>{"use strict";var n={912:(t,n,e)=>{e.r(n);const r=JSON.parse('{"u2":"matter-liquid","i8":"0.0.1"}');var o=e(538),i=e.n(o);const s=0,c=1,u=2,a=3,f=1,l=2;function p(t,n,e,r,o,i){return t>e&&t<o&&n>r&&n<i}function d(t,n,e){const r=e-n;return n+((t-n)%r+r)%r}function h(t,n){return t>n?t:n}function m(t,n,e){return t<n?n:t>e?e:t}function y(t){return Math.hypot(t[0],t[1])}function g(t){const n=Math.hypot(t[0],t[1]);return 0!==n?[t[0]/n,t[1]/n]:[0,0]}function v(t,n){return[t[0]*n,t[1]*n]}function x(t,n){return[t[0]/n,t[1]/n]}function b(t,n){return[n[0]+t[0],n[1]+t[1]]}function M(t,n){return[n[0]-t[0],n[1]-t[1]]}function w(t,n){return[t[0]-n[0],t[1]-n[1]]}function j(t,n){let e=-1;const{length:r}=t;for(;++e<r;)n(t[e],e)}function q(t,n,e,r){j(e,((t,e)=>{null===t||n&&!p(t[s],t[c],...n)||r(t,e)}))}function P(t,n,e){j(n,(n=>e(t[n],n)))}function O(t,n){return t.sh.getNearItems(n[s],n[c],t.p)}function S(t,n,e){!function(t,n,e){j(n,(n=>e(t[n],n)))}(t.p,O(t,n),e)}function R(t,n){for(const[e,r]of Object.entries(t))n(e,r)}function C(t,n,e){return i().Vertices.contains(t.vertices,{x:n,y:e})}function E(t,n=0){return[t.min.x-n,t.min.y-n,t.max.x+n,t.max.y+n]}function L(t,n,e,r){const o=(n[0]-t[0])*(r[1]-e[1])-(r[0]-e[0])*(n[1]-t[1]);if(0===o)return!1;const i=((r[1]-e[1])*(r[0]-t[0])+(e[0]-r[0])*(r[1]-t[1]))/o,s=((t[1]-n[1])*(r[0]-t[0])+(n[0]-t[0])*(r[1]-t[1]))/o;return i>0&&i<1&&s<1}function B(t,n){return M([t[s],t[c]],[n[s],n[c]])}function I(t,n){t[s]+=n[0],t[c]+=n[1]}function T(t,n){t[s]+=n*t[u],t[c]+=n*t[a]}function A(t,n){const[e,r]=function(t,n){const e=Math.hypot(t[0],t[1]);return v(x(t,e||1),m(e,-n,n))}([t[u],t[a]],n);t[u]=e,t[a]=r}function G(t,n,e){S(t,n,(r=>{const o=B(n,r),i=g(o),s=y(x(o,t.h));if(s<1){const t=(d=n,M([(h=r)[u],h[a]],[d[u],d[a]])),o=y((p=t,[(l=i)[0]*p[0],l[1]*p[1]]));if(o>0){const t=x(v(i,e*(1-s)*(.01*o+.01*o**2)),2);f=t,(c=n)[u]-=f[0],c[a]-=f[1],function(t,n){t[u]+=n[0],t[a]+=n[1]}(r,t)}}var c,f,l,p,d,h}))}function $(t,n,e){P(t.p,n,((n,r)=>{S(t,n,((o,i)=>{if(y(x(B(n,o),t.h))<1){const s=y(B(n,o));let c=10-s;const u=function(t,n){return`${t}.${n}`}(r,i),a=.1*c;s>10+a?c+=.03*e*(s-10-a):s<10-a&&(c-=.03*e*(10-a-s)),void 0===t.s[u]&&(t.s[u]=c)}}))})),R(t.s,((n,e)=>{Math.abs(e)>t.h&&(t.s[n]=void 0)})),R(t.s,((n,r)=>{const[o,i]=function(t){const[n,e]=t.split(".");return[+n,+e]}(n),u=t.p[o],a=t.p[i],f=B(u,a),l=g(f),p=y(f),d=r,h=x(v(l,e**2*.001*(1-d/t.h)*(d-p)),2);var m,b;b=h,(m=u)[s]-=b[0],m[c]-=b[1],I(a,h)}))}function _(t,n,e){const r=.2*t.h,o=.3*t.h;let i=0,s=0;const c=O(t,n),u=[];for(let e=0;e<c.length;e++){const r=t.p[c[e]],o=B(n,r),a=y(x(o,t.h));if(a<1){const t=h(1-a,.5);i+=t**2,s+=t**3,u.push([t,o,r])}}const a=.3*(i-r),f=o*s,l=[0,0];for(let t=0;t<u.length;t++){const[n,r,o]=u[t],i=x(v(g(r),e**2*(a*n+f*n**2)),2);l[0]-=i[0],l[1]-=i[1],I(o,i)}I(n,l)}function F(t,n,e){const r=[t.position.x,t.position.y];if(t.circleRadius){return b(r,v(g(M(r,e)),t.circleRadius))}var o,i;const s=function(t,n,e){const r=t.vertices;for(let t=0;t<r.length;t++){const o=r[t],i=r[t!==r.length-1?t+1:0],s=[o.x,o.y],c=[i.x,i.y];if(L(s,c,n,e))return[s,c]}return null}(t,(o=n,(i=e)[0]!==o[0]||i[1]!==o[1]?e:r),n),c=function(t,n){const e=g(M([t[0],t[1]],[n[0],n[1]]));return[e[1],-e[0]]}(s[0],s[1]);return function(t,n,e,r){const o=(t[0]-n[0])*(e[1]-r[1])-(t[1]-n[1])*(e[0]-r[0]);if(0===o)return null;const i=t[0]*n[1]-t[1]*n[0],s=e[0]*r[1]-e[1]*r[0];return[(i*(e[0]-r[0])-(t[0]-n[0])*s)/o,(i*(e[1]-r[1])-(t[1]-n[1])*s)/o]}(s[0],s[1],n,b(n,c))}function N(t,n,e){const{p:r}=t;(n?function(t,n){return i().Query.region(t,{min:{x:n[0],y:n[1]},max:{x:n[2],y:n[3]}})}(t.w.bodies,n):t.w.bodies).forEach((n=>{const e=function(t,n,e,r){const o=[],i=e.getItemsByBounds(n.bounds);for(let e=0;e<i.length;e++){const r=i[e],u=t[r];C(n,u[s],u[c])&&o.push(r)}return o}(r,n,t.sh);P(r,e,(t=>{const e=function(t,n){const e=[n.velocity.x,n.velocity.y],r=w([t[u],t[a]],e),o=g(r),i=w(r,o);return w(o,v(i,1))}(t,n),r=[t[s],t[c]];if(function(t,n){t[u]-=n[0],t[a]-=n[1]}(t,e),C(n,t[s],t[c])){const e=F(n,r,[t[s],t[c]]);t[s]=e[0],t[c]=e[1]}}))}))}function U(t,n,e,r){P(t.p,n,((n,o)=>{!function(t,n,e){t[u]=(t[s]-e[0])/n,t[a]=(t[c]-e[1])/n}(n,e,r[o]);const i=t.bb,f=t.w.bounds;if(t.iwx)n[s]=d(n[s],f.min.x,f.max.x);else{const t=n[s];n[s]=m(t,f.min.x,f.max.x),t!==n[s]&&(n[u]*=-i,n[a]*=i)}if(t.iwy)n[c]=d(n[c],f.min.y,f.max.y);else{const t=n[c];n[c]=m(t,f.min.y,f.max.y),t!==n[c]&&(n[u]*=i,n[a]*=-i)}t.sh.update(o,n[s],n[c])}))}function V(t,n){const e=[],r=Matter.Liquid.getGravity(t),o={},i=t.irc?E(t.r.bounds,t.abp):null;q(0,i,t.p,((i,f)=>{e.push(f),function(t,n,e,r){t[u]+=n*r*e[0],t[a]+=n*r*e[1]}(i,n,r,t.lpl[f][l]),o[f]=[i[s],i[c]],A(i,.6*t.h),T(i,n)})),P(t.p,e,(e=>{_(t,e,n)})),N(t,i),U(t,e,n,o)}function J(t,n){const e=E(t.r.bounds,t.abp),r=[],o=(Matter.Liquid.getGravity(t),{});q(0,e,t.p,((t,n)=>{r.push(n)})),P(t.p,r,(e=>{G(t,e,n)})),P(t.p,r,((t,e)=>{o[e]=[t[s],t[c]],T(t,n)})),$(t,r,n),P(t.p,r,(e=>{_(t,e,n)})),U(t,r,n,o)}function Q(t,n){if(OffscreenCanvas)return new OffscreenCanvas(t,n);const e=document.createElement("canvas");return e.height=n,e.width=t,e}function W(t,n){const e=Q(6*n,6*n),r=e.getContext("2d");return r.shadowColor=t,r.shadowBlur=2*n,r.fillStyle=t,r.beginPath(),r.arc(3*n,3*n,n,0,2*Math.PI),r.fill(),e}function k(t){const n=t.r.context,e=E(t.r.bounds,t.rbp);j(t.p,((r,o)=>{if(null===r||!p(r[s],r[c],...e))return;const i=Math.floor(r[s]),u=Math.floor(r[c]),a=t.lpl[o][f],l=a.height/2;n.drawImage(a,i-l,u-l)}))}function z(t){Matter.Render.startViewTransform(t.r),k(t)}function D(t){const n=Math.trunc;function e(t,n){return`${t}.${n}`}function r(t,n){const e=t.indexOf(n);return-1!==e&&t.splice(e,1),t}function o(t,n,e){const r=t.h[e];void 0===r?(t.h[e]=[n],t.p[n]=e):r.includes(n)||(r.push(n),t.p[n]=e)}function i(t,n,r){return t.h[e(n,r)]||[]}function s(t,n,e){const o=t.h[e];r(o,n),delete t.p[n],0===o.length&&delete t.h[e]}const c={h:{},p:{},cs:t,update:(t,r,i)=>{const u=n(r/c.cs),a=n(i/c.cs),f=c.p[t],l=e(u,a);f!==l&&(void 0!==f&&s(c,t,f),o(c,t,l))},insert:(t,r,i)=>{const s=e(n(r/c.cs),n(i/c.cs));o(c,t,s)},remove:t=>{const n=c.p[t];s(c,t,n)},getNearItems:(t,o,s)=>{const u=n(t/c.cs),a=n(o/c.cs),f=e(u,a);return[...i(c,u-1,a-1),...i(c,u,a-1),...i(c,u+1,a-1),...i(c,u-1,a),...r(c.h[f]||[],f),...i(c,u+1,a),...i(c,u-1,a+1),...i(c,u,a+1),...i(c,u+1,a+1)]},getItemsByBounds:t=>{const r=n(t.min.x/c.cs),o=n(t.min.y/c.cs),i=n(t.max.x/c.cs),s=n(t.max.y/c.cs),u=[];for(let t=o;t<=s;t++)for(let n=r;n<=i;n++){const r=e(n,t);u.push(...c.h[r]||[])}return u}};return Object.seal(c)}const H=["pauseChange","particleRemove"];function K(){const t={};return H.forEach((n=>t[n]=()=>0)),t}const X={drip(t,n,e,r){const o=0===t.fpids.length?t.p.length:t.fpids.pop(),i=new Float32Array([e,r,0,0]);t.lpl[o]=t.l[n],t.p[o]=i,t.sh.insert(o,e,r)},rect(t,n,e,r,o,i,s=t.h){const c=Matter.Liquid.getLiquidId(t,n),u=s/2,a=h(Math.trunc(o/s),1),f=h(Math.trunc(i/s),1);for(let n=0;n<a;n++)for(let o=0;o<f;o++){const i=e+u+n*s,l=r+u+o*s;X.drip(t,c,i,l),n!==a-1&&o!==f-1&&X.drip(t,c,i+u,l+u)}}},Y={dry(t,n){const e=t.p[n];t.p[n]=null,t.sh.remove(n),t.ev.particleRemove(e,n,t.lpl[n]),t.fpids.push(n)},rect(t,n,e,r,o){t.p.forEach(((i,u)=>{null!==i&&p(i[s],i[c],n,e,n+r,e+o)&&Y.dry(t,u)}))}},Z={utils:{VirtualCanvas:Q},create:function(t){const n=i().Liquid,e=t.radius||32,r=e*(t.particleTextureScale||.3);let o=[false,false];const s=t.worldWrapping;null!=s&&(o="boolean"==typeof s?[s,s]:s);const c={},u=t.liquids.map(((t,n)=>(t.name&&(c[t.name]=n),function(t,n){const e=t.color||"#fff";return[e,t.texture||W(e,n),t.mass||1]}(t,r)))),a={h:e,iwx:o[0],iwy:o[1],e:t.engine,r:t.render,w:t.engine.world,irc:t.isRegionalComputing||false,l:u,lnlid:c,bb:t.bordersBounce||.8,ip:!1,g:t.gravityRatio||.2,sh:D(e),rbp:0,abp:0,p:[],s:{},fpids:[],lpl:{},t:0,ef:t.updateEveryFrame||2,dt:t.timeScale||1,ev:K(),u:null},f=z,l=t.isAdvancedAlgorithm?J:V;return a.u=()=>{a.t++%a.ef==0&&l(a,a.e.timing.timeScale*a.dt)},i().Events.on(t.render,"afterRender",(()=>f(a))),n.setPause(a,!!t.isPaused),Object.seal(a)},drip:X,dry:Y,setPause(t,n=!0){n?i().Events.off(t.e,"afterUpdate",t.u):i().Events.on(t.e,"afterUpdate",t.u),t.ip=n,t.ev.pauseChange(n)},setRenderBoundsPadding(t,n){t.rbp=n},setActiveBoundsPadding(t,n){t.abp=n},setGravityRatio(t,n=t.g){t.g=n},setUpdateEveryFrame(t,n=t.ef){t.ef=n},setTimeScale(t,n=t.dt){t.dt=n},getGravity:t=>[t.w.gravity.x*t.g,t.w.gravity.y*t.g],getParticlesCount:t=>t.p.length-t.fpids.length,getLiquidId:(t,n)=>"number"==typeof n?n:t.lnlid[n]},tt={name:r.u2,version:r.i8,for:"matter-js@0.16.1",install(t){t.Liquid=Z}};Matter.Plugin.register(tt)},538:n=>{n.exports=t}},e={};function r(t){var o=e[t];if(void 0!==o)return o.exports;var i=e[t]={exports:{}};return n[t](i,i.exports,r),i.exports}return r.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return r.d(n,{a:n}),n},r.d=(t,n)=>{for(var e in n)r.o(n,e)&&!r.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},r.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r(912)})()}));