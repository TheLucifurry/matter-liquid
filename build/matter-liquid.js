/*! For license information please see matter-liquid.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("matter-js")):"function"==typeof define&&define.amd?define(["matter-js"],e):"object"==typeof exports?exports.MatterLiquid=e(require("matter-js")):t.MatterLiquid=e(t.Matter)}(self,(function(t){return(()=>{"use strict";var e={473:(t,e,s)=>{s.r(e);const n=JSON.parse('{"u2":"matter-liquid","i8":"0.0.1"}');function i(t,e){if(OffscreenCanvas)return new OffscreenCanvas(t,e);const s=document.createElement("canvas");return s.height=e,s.width=t,s}var r=s(538),o=s.n(r);function h(t){return Math.hypot(t[0],t[1])}function l(t){const e=Math.hypot(t[0],t[1]);return 0!==e?[t[0]/e,t[1]/e]:[0,0]}function a(t,e){return[t[0]*e,t[1]*e]}function c(t,e){return[t[0]/e,t[1]/e]}function u(t,e){return[e[0]-t[0],e[1]-t[1]]}function p(t,e,s,n,i,r){return t>s&&t<i&&e>n&&e<r}function f(t,e,s){const n=s-e;return e+((t-e)%n+n)%n}function d(t,e,s){return Math.min(Math.max(t,e),s)}function m(t,e=0){return[t.min.x-e,t.min.y-e,t.max.x+e,t.max.y+e]}function g(t,e){let s=-1;const{length:n}=t;for(;++s<n;)e(t[s],s)}function v(t,e,s,n){g(s,((t,s)=>{null===t||e&&!p(t[0],t[1],...e)||n(t,s)}))}function y(t,e,s){g(e,(e=>s(t[e],e)))}function x(t,e){return t.sh.getAroundCellsItems(e[0],e[1],t.p)}function b(t,e,s){!function(t,e,s){g(e,(e=>s(t[e],e)))}(t.p,x(t,e),s)}function C(t,e){for(const[s,n]of Object.entries(t))e(s,n)}function S(t,e){return u([t[0],t[1]],[e[0],e[1]])}function w(t,e){t[0]+=e[0],t[1]+=e[1]}function M(t,e,s){t[2]+=e*s[0],t[3]+=e*s[1]}function P(t,e){t[0]+=e*t[2],t[1]+=e*t[3]}function R(t,e,s){const n=.2*t.h,i=.3*t.h;let r=0,o=0;const u=x(t,e),p=[];for(let s=0;s<u.length;s++){const n=t.p[u[s]],i=S(e,n),l=h(c(i,t.h));if(l<1){const t=1-l;r+=t**2,o+=t**3,p.push([t,i,n])}}const f=.3*(r-n),d=i*o,m=[0,0];for(let t=0;t<p.length;t++){const[e,n,i]=p[t],r=c(a(l(n),s**2*(f*e+d*e**2)),2);m[0]-=r[0],m[1]-=r[1],w(i,r)}w(e,m)}function j(t,e,s,n){y(t.p,e,((e,i)=>{!function(t,e,s){t[2]=(t[0]-s[0])/e,t[3]=(t[1]-s[1])/e}(e,s,n[i]);const r=t.bb,o=t.w.bounds;if(t.iwx)e[0]=f(e[0],o.min.x,o.max.x);else{const t=e[0];e[0]=d(t,o.min.x,o.max.x),t!==e[0]&&(e[2]*=-r,e[3]*=r)}if(t.iwy)e[1]=f(e[1],o.min.y,o.max.y);else{const t=e[1];e[1]=d(t,o.min.y,o.max.y),t!==e[1]&&(e[2]*=r,e[3]*=-r)}t.sh.update(i,e[0],e[1])}))}function O(t,e){const s=t.store,n=[],i=t.getGravity(),r={};v(0,s.irc?m(s.r.bounds,s.abp):null,s.p,((t,o)=>{n.push(o),M(t,e,i),r[o]=[t[0],t[1]],function(t,e){const[s,n]=function(t,e){const s=Math.hypot(t[0],t[1]);return a(c(t,s||1),Math.max(0,Math.min(e,s)))}([t[2],t[3]],e);t[2]=s,t[3]=n}(t,.6*s.h),P(t,e)})),y(s.p,n,(t=>{R(s,t,e)})),j(s,n,e,r)}function I(t,e){const s=t.store,n=m(s.r.bounds,s.abp),i=[],r=t.getGravity(),o={};v(0,n,s.p,((t,s)=>{i.push(s),M(t,e,r)})),y(s.p,i,(t=>{!function(t,e,s){b(t,e,(n=>{const i=S(e,n),r=l(i),o=h(c(i,t.h));if(o<1){const t=h((g=e,m=u([(v=n)[2],v[3]],[g[2],g[3]]),[(d=r)[0]*m[0],d[1]*m[1]]));if(t>0){const i=c(a(r,s*(1-o)*(.01*t+.01*t**2)),2);f=i,(p=e)[2]-=f[0],p[3]-=f[1],function(t,e){t[2]+=e[0],t[3]+=e[1]}(n,i)}}var p,f,d,m,g,v}))}(s,t,e)})),y(s.p,i,((t,s)=>{o[s]=[t[0],t[1]],P(t,e)})),function(t,e,s){y(t.p,e,((e,n)=>{b(t,e,((i,r)=>{if(h(c(S(e,i),t.h))<1){const o=h(S(e,i));let l=10-o;const a=function(t,e){return`${t}.${e}`}(n,r),c=.1*l;o>10+c?l+=.03*s*(o-10-c):o<10-c&&(l-=.03*s*(10-c-o)),void 0===t.s[a]&&(t.s[a]=l)}}))})),C(t.s,((e,s)=>{Math.abs(s)>t.h&&(t.s[e]=void 0)})),C(t.s,((e,n)=>{const[i,r]=function(t){const[e,s]=t.split(".");return[+e,+s]}(e),o=t.p[i],u=t.p[r],p=S(o,u),f=l(p),d=h(p),m=n,g=c(a(f,s**2*.001*(1-m/t.h)*(m-d)),2);var v,y;y=g,(v=o)[0]-=y[0],v[1]-=y[1],w(u,g)}))}(s,i,e),y(s.p,i,(t=>{R(s,t,e)})),j(s,i,e,o)}function z(t,e){const s=t.split(".");return[s[0]*e,s[1]*e]}function T(t,e){const s=i(6*e,6*e),n=s.getContext("2d");return n.shadowColor=t,n.shadowBlur=2*e,n.fillStyle=t,n.beginPath(),n.arc(3*e,3*e,e,0,2*Math.PI),n.fill(),s}function k(t){const e=t.r.context,s=m(t.r.bounds,t.rbp);g(t.p,((n,i)=>{if(null===n||!p(n[0],n[1],...s))return;const r=Math.floor(n[0]),o=Math.floor(n[1]),h=t.lpl[i][1],l=h.height/2;e.drawImage(h,r-l,o-l)}))}function E(t){Matter.Render.startViewTransform(t.store.r),k(t.store)}function U(t){const{store:e}=t,s=e.r.context;Matter.Render.startViewTransform(e.r);const n=m(e.r.bounds,e.rbp),i=m(e.w.bounds),r=m(e.r.bounds,e.abp);!function(t){const e=t.r.context,{cellSize:s}=t.sh,n=s/2,i=Object.entries(t.sh.hash);e.textAlign="center",e.lineWidth=1,e.fillStyle="white",e.strokeStyle="green";for(const[t,r]of i){const[i,o]=z(t,s);e.fillText(r.length,i,o),e.strokeRect(i-n,o-n,s,s)}}(e),k(e),s.strokeStyle="violet",s.strokeRect(i[0],i[1],i[2]-i[0],i[3]-i[1]),s.strokeStyle="orange",s.strokeRect(r[0],r[1],r[2]-r[0],r[3]-r[1]),s.strokeStyle="cyan",s.strokeRect(n[0],n[1],n[2]-n[0],n[3]-n[1]);s.lineWidth=1,s.strokeStyle="yellow",s.beginPath(),s.moveTo(-1e3,0),s.lineTo(1e3,0),s.moveTo(0,-1e3),s.lineTo(0,1e3),s.stroke()}const q=Math.trunc;function A(t,e){return`${t}.${e}`}function B(t,e){const s=t.indexOf(e);return-1!==s&&t.splice(s,1),t}class _{constructor(){this.hash={},this.prevItemCell={}}init(t){this.cellSize=t}find(t,e){return(this.hash[t]||[]).indexOf(e)}save(t,e){const s=this.hash[e];void 0===s?(this.hash[e]=[t],this.prevItemCell[t]=e):s.includes(t)||(s.push(t),this.prevItemCell[t]=e)}getCell(t,e){return this.hash[A(t,e)]||[]}_delete(t,e){const s=this.hash[e];B(s,t),delete this.prevItemCell[t],0===s.length&&delete this.hash[e]}update(t,e,s){const n=q(e/this.cellSize),i=q(s/this.cellSize),r=this.prevItemCell[t],o=A(n,i);r!==o&&(void 0!==r&&this._delete(t,r),this.save(t,o))}clear(){this.hash={},this.prevItemCell={}}insert(t,e,s){const n=A(q(e/this.cellSize),q(s/this.cellSize));this.save(t,n)}remove(t){const e=this.prevItemCell[t];this._delete(t,e)}getAroundCellsItems(t,e,s){const n=q(t/this.cellSize),i=q(e/this.cellSize),r=A(n,i);return[...this.getCell(n-1,i-1),...this.getCell(n,i-1),...this.getCell(n+1,i-1),...this.getCell(n-1,i),...B(this.hash[r]||[],r),...this.getCell(n+1,i),...this.getCell(n-1,i+1),...this.getCell(n,i+1),...this.getCell(n+1,i+1)]}fill(t){t.forEach(((t,e)=>{const s=t[0],n=t[1];this.insert(e,s,n)}))}getItemsOfCellsInBounds(t){const e=q(t.min.x/this.cellSize),s=q(t.min.y/this.cellSize),n=q(t.max.x/this.cellSize),i=q(t.max.y/this.cellSize),r=[];for(let t=s;t<=i;t++)for(let s=e;s<=n;s++){const e=A(s,t);r.push(...this.hash[e]||[])}return r}}const G=["pauseChange","particleRemove"];class L extends class{constructor(t){this.events=function(){const t={};return G.forEach((e=>t[e]=()=>0)),t}();const e=t.radius||32,s=e*(t.particleTextureScale||.3);let n=[!1,!1];const i=t.worldWrapping;null!=i&&(n="boolean"==typeof i?[i,i]:i),this.store=Object.seal({h:e,iwx:n[0],iwy:n[1],e:t.engine,r:t.render,w:t.engine.world,irc:t.isRegionalComputing||!1,l:t.liquids.map((t=>function(t,e){const s=t.color||"#fff";return[s,t.texture||T(s,e)]}(t,s))),bb:t.bordersBounce||.8,ip:!1,g:.2,sh:new _,rbp:0,abp:0,p:[],s:{},fpids:[],lpl:{},t:0,ef:2,dt:1})}setPause(t=!0){this.store.ip=t,this.events.pauseChange(t)}setRenderBoundsPadding(t){this.store.rbp=t}setActiveBoundsPadding(t){this.store.abp=t}setGravityRatio(t=this.store.g){this.store.g=t}setUpdateEveryFrame(t=this.store.ef){this.store.ef=t}setTimeScale(t=this.store.dt){this.store.dt=t}getGravity(){return[this.store.w.gravity.x*this.store.g,this.store.w.gravity.y*this.store.g]}getParticlesCount(){return this.store.p.length-this.store.fpids.length}}{constructor(t){super(t),this.setGravityRatio(t.gravityRatio),this.store.sh.init(this.store.h),this.setUpdateEveryFrame(t.updateEveryFrame),this.setTimeScale(t.timeScale),this.setUpdaters(t),o().Events.on(t.render,"afterRender",this.updateRender.bind(this))}setUpdaters(t){this.renderUpdater=t.isDebug?U:E,this.computeUpdater=t.isAdvancedAlgorithm?I:O,this.updateCompute=this.updateCompute.bind(this),this.setPause(!!t.isPaused)}updateCompute(){this.store.t++%this.store.ef==0&&this.computeUpdater(this,this.store.e.timing.timeScale*this.store.dt)}updateRender(){this.renderUpdater(this)}setPause(t=!0){t?o().Events.off(this.store.e,"afterUpdate",this.updateCompute):o().Events.on(this.store.e,"afterUpdate",this.updateCompute),super.setPause(t)}spawnParticle(t,e,s){const n=0===this.store.fpids.length?this.store.p.length:this.store.fpids.pop(),i=new Float32Array([e,s,0,0]);this.store.lpl[n]=this.store.l[t],this.store.p[n]=i,this.store.sh.insert(n,e,s)}removeParticle(t){const e=this.store.p[t];this.store.p[t]=null,this.store.sh.remove(t),this.events.particleRemove(e,t,this.store.lpl[t]),this.store.fpids.push(t)}fillZoneByLiquid(t,e,s,n,i,r=this.store.h){const o=r/2,h=Math.max(1,Math.trunc(s/r)),l=Math.max(1,Math.trunc(n/r));for(let s=0;s<h;s++)for(let n=0;n<l;n++){const a=t+o+s*r,c=e+o+n*r;this.spawnParticle(i,a,c),s!==h-1&&n!==l-1&&this.spawnParticle(i,a+o,c+o)}}clearZoneByLiquid(t,e,s,n,i){this.store.p.forEach(((i,r)=>{null!==i&&p(i[0],i[1],t,e,t+s,e+n)&&this.removeParticle(r)}))}checkRectContainsParticle(t,e){return p(e[0],e[1],...t)}}const F={name:n.u2,version:n.i8,for:"matter-js@0.16.1",install(t){t.Liquid={create:t=>new L(t),VirtualCanvas:i}}};Matter.Plugin.register(F)},538:e=>{e.exports=t}},s={};function n(t){var i=s[t];if(void 0!==i)return i.exports;var r=s[t]={exports:{}};return e[t](r,r.exports,n),r.exports}return n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(473)})()}));