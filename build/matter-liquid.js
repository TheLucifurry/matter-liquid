!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("matter-js")):"function"==typeof define&&define.amd?define(["matter-js"],n):"object"==typeof exports?exports.MatterLiquid=n(require("matter-js")):t.MatterLiquid=n(t.Matter)}(self,(function(t){return(()=>{"use strict";var n={35:(t,n,e)=>{e.r(n);const r=JSON.parse('{"u2":"matter-liquid","i8":"0.0.1"}');var o=e(538),i=e.n(o);const c=0,s=1,u=2,a=3,l=0,f=3,p=4;function d(t,n,[e,r,o,i]){return t>e&&t<o&&n>r&&n<i}function h(t,n,e){const r=e-n;return n+((t-n)%r+r)%r}function g(t,n){return t>n?t:n}function m(t,n,e){return t<n?n:t>e?e:t}function x(t){const n=t.length,[e,r,o,i,c,s,u,a,l]=t;return n<6?[`0x${r}`/15,`0x${o}`/15,`0x${i}`/15,5===n?`0x${c}`/15:1]:[`0x${r}${o}`/255,`0x${i}${c}`/255,`0x${s}${u}`/255,9===n?`0x${a}${l}`/255:1]}function y(t){return Math.hypot(t[0],t[1])}function b(t){const n=Math.hypot(t[0],t[1]);return 0!==n?[t[0]/n,t[1]/n]:[0,0]}function v(t,n){return[t[0]*n,t[1]*n]}function M(t,n){return[t[0]/n,t[1]/n]}function R(t,n){return[n[0]+t[0],n[1]+t[1]]}function w(t,n){return[n[0]-t[0],n[1]-t[1]]}function q(t,n){return[t[0]-n[0],t[1]-n[1]]}function j(t,n){let e=-1;const{length:r}=t;for(;++e<r;)n(t[e],e)}function L(t,n,e,r){j(e,((t,e)=>{null===t||n&&!d(t[c],t[s],n)||r(t,e)}))}function O(t,n,e){j(n,(n=>e(t[n],n)))}function P(t,n){const e=t.p[n];return t.sh.getNearby(e[c],e[s],t.p)}function S(t,n,e){!function(t,n,e){j(n,(n=>e(t[n],n)))}(t.p,P(t,n),e)}function $(t,n){for(const[e,r]of Object.entries(t))n(e,r)}function E(t,n,e){return i().Vertices.contains(t.vertices,{x:n,y:e})}function C(t,n=0){return[t.min.x-n,t.min.y-n,t.max.x+n,t.max.y+n]}function B(t,n,e,r){const o=(n[0]-t[0])*(r[1]-e[1])-(r[0]-e[0])*(n[1]-t[1]);if(0===o)return!1;const i=((r[1]-e[1])*(r[0]-t[0])+(e[0]-r[0])*(r[1]-t[1]))/o,c=((t[1]-n[1])*(r[0]-t[0])+(n[0]-t[0])*(r[1]-t[1]))/o;return i>0&&i<1&&c<1}function F(t,n){return w([t[c],t[s]],[n[c],n[s]])}function I(t,n,e){const r=n;t[c]+=r[0],t[s]+=r[1]}function A(t,n){t[c]+=n*t[u],t[s]+=n*t[a]}function T(t,n){const[e,r]=function(t,n){const e=Math.hypot(t[0],t[1]);return v(M(t,e||1),m(e,-n,n))}([t[u],t[a]],n);t[u]=e,t[a]=r}function G(t,n,e){const r=t.p[n];S(t,n,(n=>{const o=F(r,n),i=b(o),c=y(M(o,t.h));if(c<1){const t=(d=r,w([(h=n)[u],h[a]],[d[u],d[a]])),o=y((p=t,[(f=i)[0]*p[0],f[1]*p[1]]));if(o>0){const t=M(v(i,e*(1-c)*(.01*o+.01*o**2)),2);l=t,(s=r)[u]-=l[0],s[a]-=l[1],function(t,n){t[u]+=n[0],t[a]+=n[1]}(n,t)}}var s,l,f,p,d,h}))}function N(t,n,e){O(t.p,n,((n,r)=>{S(t,r,((r,o)=>{if(y(M(F(n,r),t.h))<1){const o=y(F(n,r));let i=10-o;const c=0,s=.1*i;o>10+s?i+=.03*e*(o-10-s):o<10-s&&(i-=.03*e*(10-s-o)),void 0===t.s[c]&&(t.s[c]=i)}}))})),$(t.s,((n,e)=>{Math.abs(e)>t.h&&(t.s[n]=void 0)})),$(t.s,((n,r)=>{const[o,i]=function(t){const[n,e]=t.split(".");return[+n,+e]}(n),u=t.p[o],a=F(u,t.p[i]),l=b(a),f=y(a),p=r,d=M(v(l,e**2*.001*(1-p/t.h)*(p-f)),2);var h,g;g=d,(h=u)[c]-=g[0],h[s]-=g[1]}))}function _(t,n,e){const r=[t.position.x,t.position.y];if(t.circleRadius){return R(r,v(b(w(r,e)),t.circleRadius))}var o,i;const c=function(t,n,e){const r=t.vertices;for(let t=0;t<r.length;t++){const o=r[t],i=r[t!==r.length-1?t+1:0],c=[o.x,o.y],s=[i.x,i.y];if(B(c,s,n,e))return[c,s]}return null}(t,(o=n,(i=e)[0]!==o[0]||i[1]!==o[1]?e:r),n),s=function(t,n){const e=b(w([t[0],t[1]],[n[0],n[1]]));return[e[1],-e[0]]}(c[0],c[1]);return function(t,n,e,r){const o=(t[0]-n[0])*(e[1]-r[1])-(t[1]-n[1])*(e[0]-r[0]);if(0===o)return null;const i=t[0]*n[1]-t[1]*n[0],c=e[0]*r[1]-e[1]*r[0];return[(i*(e[0]-r[0])-(t[0]-n[0])*c)/o,(i*(e[1]-r[1])-(t[1]-n[1])*c)/o]}(c[0],c[1],n,R(n,s))}function V(t,n,e,r){const{p:o}=t;(n?function(t,n){return i().Query.region(t,{min:{x:n[0],y:n[1]},max:{x:n[2],y:n[3]}})}(t.w.bodies,n):t.w.bodies).forEach((n=>{const r=function(t,n,e,r){const o=[],i=e.getFromBounds(n.bounds);for(let e=0;e<i.length;e++){const r=i[e],u=t[r];E(n,u[c],u[s])&&o.push(r)}return o}(o,n,t.sh);O(o,r,(t=>{if(!d(t[c],t[s],e))return;const r=function(t,n){const e=[n.velocity.x,n.velocity.y],r=q([t[u],t[a]],e),o=b(r),i=q(r,o);return q(o,v(i,1))}(t,n),o=[t[c],t[s]];if(function(t,n){t[u]-=n[0],t[a]-=n[1]}(t,r),E(n,t[c],t[s])){const e=_(n,o,[t[c],t[s]]);t[c]=e[0],t[s]=e[1]}}))}))}function U(t,n,e,r){O(t.p,n,((n,o)=>{!function(t,n,e){t[u]=(t[c]-e[0])/n,t[a]=(t[s]-e[1])/n}(n,e,r[o]);const i=t.bb,l=t.b;if(t.iwx)n[c]=h(n[c],l[0],l[2]);else{const t=n[c];n[c]=m(t,l[0],l[2]),t!==n[c]&&(n[u]*=-i,n[a]*=i)}if(t.iwy)n[s]=h(n[s],l[1],l[3]);else{const t=n[s];n[s]=m(t,l[1],l[3]),t!==n[s]&&(n[u]*=i,n[a]*=-i)}t.sh.update(o,n[c],n[s])}));const o=t.x,i=t.lpl;if(o.isReady)for(let n=0;n<o.colls.length;n++){if(!o.canReacts[n])continue;const e=o.colls[n],r=[],c=[];t.l.forEach(((t,n)=>{r[n]=[],c[n]=[]}));const s=Object.keys(e);for(let t=0;t<s.length;t++){const n=s[t],o=e[n];for(let t=0;t<o.length;t++){const e=o[t],s=i[e][l];r[s].push(n),c[s].push(e)}}const u=[r,c];o.cbs[n](u)}}function W(t,n){const e=[],r=Matter.Liquid.getGravity(t),o={},i=t.irc?C(t.r.bounds,t.abp):null,f=t.b,d=.75*t.h;t.x.colls=t.l.map((()=>[])),L(0,i,t.p,((i,l)=>{e.push(l),function(t,n,e,r){t[u]+=n*r*e[0],t[a]+=n*r*e[1]}(i,n,r,t.lpl[l][p]),o[l]=[i[c],i[s]],T(i,d),A(i,n),t.sh.update(l,i[c],i[s])})),O(t.p,e,((e,r)=>{!function(t,n,e,r){const o=t.lpl[e][p],i=t.lpl[e][l],c=.2*t.h,s=.3*t.h,u=(t.h,t.x),a=t.lpl[e],f=u.isReady&&u.canReacts[i];f&&(u.colls[i][e]=[]);let d=0,h=0;const m=P(t,e),x=Array(m.length);for(let r=0;r<m.length;r++){const o=m[r],c=F(n,t.p[o]),s=g(1-y(M(c,t.h)),.5);d+=s**2,h+=s**3,x[r]=[s,o,c],f&&t.lpl[o]!==a&&u.colls[i][e].push(o)}const R=.3*(d-c)*o,w=s*h,q=[0,0];for(let n=0;n<x.length;n++){const[e,o,i]=x[n],c=t.p[o],s=M(v(b(i),r**2*(R*e+w*e**2)),2);q[0]-=s[0],q[1]-=s[1],I(c,s),t.sh.update(o,c[0],c[1])}I(n,q),t.sh.update(e,n[0],n[1])}(t,e,r,n)})),V(t,i,f),U(t,e,n,o)}function k(t,n){const e=C(t.r.bounds,t.abp),r=[],o=(Matter.Liquid.getGravity(t),{});L(0,e,t.p,((t,n)=>{r.push(n)})),O(t.p,r,((e,r)=>{G(t,r,n)})),O(t.p,r,((t,e)=>{o[e]=[t[c],t[s]],A(t,n)})),N(t,r,n),O(t.p,r,(t=>{})),U(t,r,n,o)}function H(t,n){if(OffscreenCanvas)return new OffscreenCanvas(t,n);const e=document.createElement("canvas");return e.height=n,e.width=t,e}function J(t,n){const e=H(6*n,6*n),r=e.getContext("2d");return r.shadowColor=t,r.shadowBlur=2*n,r.fillStyle=t,r.beginPath(),r.arc(3*n,3*n,n,0,2*Math.PI),r.fill(),e}function Q(t){const n=t.r.context,e=C(t.r.bounds,t.rbp),r=t.sh.getFromRect(e);for(let e=0;e<r.length;e++){const o=r[e],i=t.p[o],u=Math.floor(i[c]),a=Math.floor(i[s]),l=t.lpl[o][f],p=l.height/2;n.drawImage(l,u-p,a-p)}}function z(t){t.r.context;Matter.Render.startViewTransform(t.r),Q(t)}function D(t,n){const e=n.min.x,r=n.min.y,o=Math.round((n.max.x-n.min.x)/t);function i(t,n){return n*o+t}function c(t,n,e){const r=t.h[e];void 0===r?(t.h[e]=[n],t.p[n]=e):r.includes(n)||(r.push(n),t.p[n]=e)}function s(t,n,e){return t.h[i(n,e)]||[]}function u(t,n,e){!function(t,n){const e=t.indexOf(n);-1!==e&&t.splice(e,1)}(t.h[e],n),delete t.p[n]}const a={h:[],p:{},update:(n,o,s)=>{const l=Math.trunc((o-e)/t),f=Math.trunc((s-r)/t),p=a.p[n],d=i(l,f);p!==d&&(void 0!==p&&u(a,n,p),c(a,n,d))},insert:(n,o,s)=>{const u=i(Math.trunc((o-e)/t),Math.trunc((s-r)/t));c(a,n,u)},remove:t=>{const n=a.p[t];u(a,t,n)},getNearby:(n,o,i)=>{const c=Math.trunc((n-e)/t),u=Math.trunc((o-r)/t),l=[...s(a,c-1,u-1),...s(a,c,u-1),...s(a,c+1,u-1),...s(a,c-1,u),...s(a,c+1,u),...s(a,c-1,u+1),...s(a,c,u+1),...s(a,c+1,u+1)],f=s(a,c,u).slice();for(let e=0;e<l.length;e++){const r=l[e],c=i[r];(c[0]-n)**2+(c[1]-o)**2<=t**2&&f.push(r)}return f},getFromBounds:t=>a.getFromRect([t.min.x,t.min.y,t.max.x,t.max.y]),getFromRect:n=>{const o=Math.trunc((n[0]-e)/t),i=Math.trunc((n[1]-r)/t),c=Math.trunc((n[2]-e)/t),u=Math.trunc((n[3]-r)/t),l=[];for(let t=i;t<=u;t++)for(let n=o;n<=c;n++)l.push(...s(a,n,t));return l}};return Object.seal(a)}const K=["pauseChange","particleRemove"];function X(){const t={};return K.forEach((n=>t[n]=()=>0)),t}const Y={drip(t,n,e,r){const o=0===t.fpids.length?t.p.length:t.fpids.pop(),i=new Float32Array([e,r,0,0]);t.lpl[o]=t.l[n],t.p[o]=i,t.sh.insert(o,e,r),t.st.cl[n]++},rect(t,n,e,r,o,i,c=t.h){const s=Matter.Liquid.getLiquidId(t,n),u=c/2,a=g(Math.trunc(o/c),1),l=g(Math.trunc(i/c),1);for(let n=0;n<a;n++)for(let o=0;o<l;o++){const i=e+u+n*c,f=r+u+o*c;Y.drip(t,s,i,f),n!==a-1&&o!==l-1&&Y.drip(t,s,i+u,f+u)}}},Z={dry(t,n){const e=t.lpl[n],r=t.p[n];t.p[n]=null,t.sh.remove(n),t.ev.particleRemove(r,n,e),-1===t.fpids.indexOf(n)&&t.fpids.unshift(n),t.st.cl[e[l]]--},rect(t,n,e,r,o){t.p.forEach(((i,u)=>{null!==i&&d(i[c],i[s],[n,e,n+r,e+o])&&Z.dry(t,u)}))}},tt={trans(t,n,e){const r=t.lpl,o=t.l[e];n.forEach((t=>r[t]=o))},transByName(t,n,e){tt.trans(t,n,Matter.Liquid.getLiquidId(t,e))},transRect(t,n,e,r,o,i){const u=Matter.Liquid.getLiquidId(t,n),a=[];t.p.forEach(((t,n)=>{null!==t&&d(t[c],t[s],[e,r,e+o,r+i])&&a.push(n)})),tt.trans(t,a,u)},reacts(t,n,e){const r=Matter.Liquid.getLiquidId(t,n);t.x.canReacts[r]=!0,t.x.cbs[r]=e}},nt={utils:{VirtualCanvas:H},create:function(t){const n=i().Liquid,e=t.radius||32,r=e*(t.particleTextureScale||.3);let o=[false,false];const c=t.worldWrapping;null!=c&&(o="boolean"==typeof c?[c,c]:c);const s={},u=t.liquids.map(((t,n)=>(t.name&&(s[t.name]=n),function(t,n,e){const r=n.color||"#fff";return[t,r,x(r),n.texture||J(r,e),n.mass||1]}(n,t,r)))),a=t.render.canvas,l=H(a.clientWidth,a.clientHeight).getContext("webgl2"),f=z,p=t.isAdvancedAlgorithm?k:W,d=t.updateEveryFrame||2,h=t.bounds,g=t.engine.timing;let m=0;const y={h:e,iwx:o[0],iwy:o[1],b:[h.min.x,h.min.y,h.max.x,h.max.y,h.max.x-h.min.x,h.max.y-h.min.y],e:t.engine,r:t.render,w:t.engine.world,c:l,irc:t.isRegionalComputing||false,l:u,lnlid:s,x:{isReady:!1,iterStep:10,canReacts:[],colls:[],cbs:[]},bb:t.bordersBounce||.5,ip:!1,g:t.gravityRatio||.2,sh:D(e,h),rbp:0,abp:0,p:[],s:{},fpids:[],lpl:{},dt:t.timeScale||1,ev:X(),st:{cl:u.map((()=>0))},u:()=>{m++%d==0&&(y.x.isReady=m%y.x.iterStep==0,p(y,g.timeScale*y.dt))}};return i().Events.on(t.render,"afterRender",(()=>f(y))),n.setPause(y,!!t.isPaused),Object.seal(y)},drip:Y,dry:Z,chemics:tt,setPause(t,n=!0){n?i().Events.off(t.e,"afterUpdate",t.u):i().Events.on(t.e,"afterUpdate",t.u),t.ip=n,t.ev.pauseChange(n)},setRenderBoundsPadding(t,n){t.rbp=n},setActiveBoundsPadding(t,n){t.abp=n},setGravityRatio(t,n=t.g){t.g=n},setTimeScale(t,n=t.dt){t.dt=n},getGravity:t=>[t.w.gravity.x*t.g,t.w.gravity.y*t.g],getParticlesCount:t=>t.p.length-t.fpids.length,getLiquidId:(t,n)=>"number"==typeof n?n:t.lnlid[n]},et={name:r.u2,version:r.i8,for:"matter-js@0.17.1",install(t){t.Liquid=nt}};Matter.Plugin.register(et)},538:n=>{n.exports=t}},e={};function r(t){var o=e[t];if(void 0!==o)return o.exports;var i=e[t]={exports:{}};return n[t](i,i.exports,r),i.exports}return r.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return r.d(n,{a:n}),n},r.d=(t,n)=>{for(var e in n)r.o(n,e)&&!r.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},r.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r(35)})()}));